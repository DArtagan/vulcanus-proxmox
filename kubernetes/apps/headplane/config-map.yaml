kind: ConfigMap
apiVersion: v1
metadata:
  name: headscale
data:
  config.yaml: |
    server:
      host: "0.0.0.0"
      port: 3000

      # The secret used to encode and decode web sessions
      # Ensure that this is exactly 32 characters long
      cookie_secret_path: /secrets/cookie_secret

      # Should the cookies only work over HTTPS? (should be true in production)
      cookie_secure: true
      data_path: "/var/lib/headplane"

    # Headscale specific settings to allow Headplane to talk
    # to Headscale and access deep integration features
    headscale:
      url: "https://headscale.immortalkeep.com"
      config_path: "/etc/headscale/config.yaml"
      # Headplane internally validates the Headscale configuration
      config_strict: true

      # If you are using `dns.extra_records_path` in your Headscale
      # configuration, you need to set this to the path for Headplane
      # to be able to read the DNS records.
      #
      # Pass it in if using Docker and ensure that the file is both
      # readable and writable to the Headplane process.
      # When using this, Headplane will no longer need to automatically
      # restart Headscale for DNS record changes.
      # dns_records_path: "/var/lib/headplane/extra_records.json"

    # Integration configurations for Headplane to interact with Headscale
    integration:
      agent:
        # The Headplane agent allows retrieving information about nodes
        # This allows the UI to display version, OS, and connectivity data
        # You will see the Headplane agent in your Tailnet as a node when
        # it connects.
        enabled: true
        # To connect to your Tailnet, you need to generate a pre-auth key
        # This can be done via the web UI or through the `headscale` CLI.
        pre_authkey_path: /secrets/pre_authkey
        # host_name: "headplane-agent"

      # Only one of these should be enabled at a time or you will get errors
      # This does not include the agent integration (above), which can be enabled
      # at the same time as any of these and is recommended for the best experience.
      docker:
        enabled: false

      # Please refer to docs/integration/Kubernetes.md for more information
      # on how to configure the Kubernetes integration. There are requirements in
      # order to allow Headscale to be controlled by Headplane in a cluster.
      kubernetes:
        enabled: true
        # Validates the manifest for the Pod to ensure all of the criteria
        # are set correctly. Turn this off if you are having issues with
        # shareProcessNamespace not being validated correctly.
        validate_manifest: true
        # This should be the name of the Pod running Headscale and Headplane.
        # If this isn't static you should be using the Kubernetes Downward API
        # to set this value (refer to docs/Integrated-Mode.md for more info).
        pod_name: "headscale"

      # Proc is the "Native" integration that only works when Headscale and Headplane are running outside of a container.
      proc:
        enabled: false

    ## OIDC Configuration for simpler authentication
    ## (This is optional, but recommended for the best experience)
    #oidc:
    #  issuer: "https://accounts.google.com"

    #  # If your OIDC provider does not support discovery (does not have the URL at
    #  # `/.well-known/openid-configuration`), you need to manually set endpoints.
    #  # This also works to override endpoints if you so desire or if your OIDC
    #  # discovery is missing certain endpoints (ie GitHub).
    #  # For some typical providers, see the documentation.

    #  # authorization_endpoint: ""
    #  # token_endpoint: ""
    #  # userinfo_endpoint: ""

    #  # The client ID for the OIDC client
    #  # For the best experience please ensure this is *identical* to the client_id
    #  # you are using for Headscale. A lot of OIDC providers will use different
    #  # subjects per user based on the client_id and for this to work correctly
    #  # they need to be identical between Headscale and Headplane.
    #  client_id: "your-client-id"

    #  # The client secret for the OIDC client
    #  # Either this or `client_secret_path` must be set for OIDC to work
    #  client_secret: "<your-client-secret>"
    #  # You can alternatively set `client_secret_path` to read the secret from disk.
    #  # The path specified can resolve environment variables, making integration
    #  # with systemd's `LoadCredential` straightforward:
    #  # client_secret_path: "${CREDENTIALS_DIRECTORY}/oidc_client_secret"

    #  # Defaults to 'openid email profile'
    #  # scope: "openid email profile"

    #  disable_api_key_login: false
    #  token_endpoint_auth_method: "client_secret_post"

    #  # If you are using OIDC, you need to generate an API key
    #  # that can be used to authenticate other sessions when signing in.
    #  #
    #  # This can be done with `headscale apikeys create --expiration 999d`
    #  headscale_api_key: "<your-headscale-api-key>"

    #  # Optional, but highly recommended otherwise Headplane
    #  # will attempt to automatically guess this from the issuer
    #  #
    #  # This should point to your publicly accessibly URL
    #  # for your Headplane instance with /admin/oidc/callback
    #  redirect_uri: "http://localhost:3000/admin/oidc/callback"

    #  # By default profile pictures are pulled from the OIDC provider when
    #  # we go to fetch the userinfo endpoint. Optionally, this can be set to
    #  # "oidc" or "gravatar" as of 0.6.1.
    #  # profile_picture_source: "gravatar"

    #  # Extra query parameters can be passed to the authorization endpoint
    #  # by setting them here. This is useful for providers that require any kind
    #  # of custom hinting.
    #  # extra_params:
    #  #   prompt: "select_account" # Example: force account selection on Google
